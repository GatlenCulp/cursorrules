---
globs: *.typ
description: Instructions for how to properly write math in Typst
alwaysApply: false
---

## 1. Physica Package and Math Notation Preferences

This project uses the Typst `physica` package for enhanced math utilities.

**Semantic Symbols**
Use semantic notation instead of generic symbols:
- Operators: `grad` not `nabla`, `product` not `Pi`
- Evaluation: `evaluated(dot)_(x=0)` not `dot |_(x=0)`
- Inner products: `iprod(x, y)` not `angle.l x, y angle.r`
- Norms and absolute values: `norm(dot)` not `||dot||`, `abs(dot)` not `|dot|`
- Sets: `Set(dot)` not `{dot}`
- Exception: Use `oo` instead of `infinity`

**Calculus Notation**
- Differentials: `dd(x)`
- Derivatives: `dv(f,x)` for total derivatives
- Partial derivatives: `pdv(f,x)`

**Operators and Syntax**
- Disambiguate equals: `<-` for assignment, `:=` for definition, `=` for boolean equality
- Disambiguate membership: `:in` for definition, `in` for boolean membership
- Function subscripts/superscripts: Always include space before parentheses: `V_pi (s)` not `V_pi(s)`
- Prefer interval notation where appropriate: `p in [0, 1]` over `0 <= p <= 1`

**Typography**
- Vector bold: `vb(x)`
- Mathcal letters: `cal(A)`

// TODO: [typst-template] Standardize RV notation in my notes. Distributed according to, RV, domain, etc.
// TODO: [typst-template] Add my notes from my prompt templates such as with capitalizations and styles.
// TODO: [typst-template] Parameter assignment operator in functions (e.g. $f(x=x_0)$)

## 2. Other Typst Preferences

**Labels and References**
- Add labels with proper prefixes to all generated items: `<sec:name>`, `<fig:name>`, `<eq:name>`, `<tab:name>`, etc.
- Reference labeled items in text using: `@sec:name`, `@fig:name`, `@eq:name`, etc.

## 3. How to Show Work in Typst

Make math source code readable with line breaks and indentation, treating it like syntax in any other language.

**For short equations:** Use `&` for alignment

**For longer derivations:** If equations are long, omit alignment characters. For long derivations add extra line breaks between equations. Use `=` to update an expression and `=>` to update an equation.

**Example:**

```typst
Solving:
$
  evaluated(grad_Delta V(theta + Delta))_(Delta = 0)
  = evaluated(
    EE_(tau ~ P) [
      R(tau)/(product_(t) pi_(theta) (a_t | s_t))
      sum_(t=0)^oo [
        grad_Delta pi_(theta + Delta) (a_t | s_t)
        product_(t' != t) (pi_(theta + Delta) (a_t' | s_t'))
      ]
    ]
  )_(Delta = 0) \
  \
  = EE_(tau ~ P) [
    R(tau)/(product_(t) pi_(theta) (a_t | s_t))
    sum_(t=0)^oo [
      ( grad_theta pi_(theta) (a_t | s_t))
      product_(t' != t) (pi_(theta) (a_t' | s_t'))
    ]
  ]
  \
  \ "Make prod independent of t and factor it out" \
  = EE_(tau ~ P) [
    R(tau)/(product_(t) pi_(theta) (a_t | s_t))
    sum_(t=0)^oo [
      (grad_theta pi_(theta) (a_t | s_t))
      (product_(t') (pi_(theta) (a_t' | s_t'))) / (pi_(theta) (a_t | s_t))
    ]
  ]
  \ ...
$
```

## 4. Common Typst/LaTeX Mistakes

**Remember: Typst is NOT LaTeX**

**Environments**
- Don't use `begin` or `end` environments

**Line Breaks**
- `\` followed by a space or newline creates a line break in Typst
- Don't use `\\` (that just escapes a backslash)

**Command Syntax**
- No backslash prefix needed: `abs` not `\abs`, `alpha` not `\alpha`, `Delta` not `\Delta`, `quad` not `\quad`

**Grouping**
- Use `()` not `{}` for grouping: `x_(i j)` not `x_{ij}`
- Note: Include spaces in multi-character subscripts (`i j`) to prevent Typst from looking for a nonexistent `ij` symbol

**Text in Math Mode**
- Multi-character text requires quotes: `f_"ext"` not `f_ext`
- Example: `J_"reflected" := N^2 J_"load"` not `J_(reflected) := N^2 J_(load)`
- Use `"my text"` not `\text{my text}`: `d_"min" (q)` not `d_\text{min}(q)`

**Spacing and Sizing**
- Don't use `\,` or `\;` for spacing—Typst handles spacing automatically
- Use `quad` when manual spacing is needed
- Don't use `\big`, `\Big`, etc.—Typst automatically sizes delimiters

**Special Notation**
- Monogram notation: Use `attach(p, tl: C, tr: s_i)` not LaTeX's `{}^C p^(s_i)` syntax

**Block vs Inline Math**
- Block math requires whitespace between `$` and content: `$ f(x) $` is block
- Inline math has no whitespace: `$f(x)$` is inline
